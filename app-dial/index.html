<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Laurent · Outbound Broker · Bland.ai Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Axios CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header-main">
    <h1>Laurent · Outbound Broker · Bland.ai Console</h1>
    <p class="desc">
      Single HTML page for agents to configure Laurent’s persona, start outbound
      calls, list voices, listen to active calls, and trigger a voice sample.
    </p>
  </header>

  <form id="call-form" class="layout" autocomplete="off">
    <!-- LEFT COLUMN: HEADERS + CALL CONFIG -->
    <div class="stack">
      <!-- API CONFIG -->
      <div class="card">
        <div class="section-title">
          <span class="label">API Credentials</span>
          <span class="badge">Headers</span>
        </div>
        <div class="form-grid-2">
          <div class="field">
            <label for="api_key">Authorization (API Key)</label>
            <input
              type="text"
              id="api_key"
              name="api_key"
              placeholder="YOUR_BLAND_API_KEY"
              required
            />
            <div class="small">
              Sent as <code>Authorization</code> header.
            </div>
          </div>
          <div class="field">
            <label for="encrypted_key">encrypted_key</label>
            <input
              type="text"
              id="encrypted_key"
              name="encrypted_key"
              value="0ec48f6b-9d48-4e8b-b050-c59d7d673a85"
              required
            />
            <div class="small">
              Sent as <code>encrypted_key</code> header.
            </div>
          </div>
        </div>
      </div>

      <!-- CALL CONFIG -->
      <div class="card">
        <div class="section-title">
          <span class="label">Call Configuration</span>
          <span class="badge">/v1/calls</span>
        </div>

        <div class="form-grid-2">
          <div class="field">
            <label for="phone_number">Client Phone Number</label>
            <input
              type="tel"
              id="phone_number"
              name="phone_number"
              value="+32"
              placeholder="+32XXXXXXXXX"
              required
            />
            <div class="small">Full E.164 number of the callee.</div>
          </div>

          <div class="field">
            <label for="from">From (Caller ID)</label>
            <input
              type="tel"
              id="from"
              name="from"
              value="+17348758838"
              placeholder="+1XXXXXXXXXX"
              required
            />
            <div class="small">Number registered in Bland.ai (caller).</div>
          </div>
        </div>

        <div class="form-grid-2">
          <div class="field">
            <label for="voice">Voice ID</label>
            <input
              type="text"
              id="voice"
              name="voice"
              value="55337f4e-482c-4644-b94e-d9671e4d7079"
              required
            />
            <div class="small">Voice ID used by Laurent.</div>
          </div>

          <div class="field">
            <label for="model">Model</label>
            <input
              type="text"
              id="model"
              name="model"
              value="base"
              required
            />
            <div class="small">Model name (e.g. <code>base</code>).</div>
          </div>
        </div>

        <div class="form-grid-3">
          <div class="field">
            <label for="language">Language</label>
            <input type="text" id="language" name="language" value="en" />
            <div class="small">Primary language (e.g. en).</div>
          </div>

          <div class="field">
            <label for="background_track">Background Track</label>
            <input
              type="text"
              id="background_track"
              name="background_track"
              value="office"
            />
            <div class="small">Example: <code>office</code>.</div>
          </div>

          <div class="field">
            <label for="voicemail_action">Voicemail Action</label>
            <input
              type="text"
              id="voicemail_action"
              name="voicemail_action"
              value="hangup"
            />
            <div class="small">e.g. <code>hangup</code>.</div>
          </div>
        </div>

        <div class="form-grid-3">
          <div class="field">
            <label for="interruption_threshold">
              Interruption Threshold (ms)
            </label>
            <input
              type="number"
              id="interruption_threshold"
              name="interruption_threshold"
              value="500"
              min="0"
            />
          </div>

          <div class="field">
            <label for="max_duration">Max Duration (minutes)</label>
            <input
              type="number"
              id="max_duration"
              name="max_duration"
              value="28.6"
              step="0.1"
              min="0"
            />
          </div>

          <div class="field">
            <label for="endpoint">Endpoint (data field)</label>
            <input
              type="url"
              id="endpoint"
              name="endpoint"
              value="https://api.bland.ai"
            />
          </div>
        </div>

        <div class="pill-row">
          <div class="checkbox-row">
            <input
              type="checkbox"
              id="wait_for_greeting"
              name="wait_for_greeting"
            />
            <label for="wait_for_greeting" class="mb-0">
              Wait for greeting
            </label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="record" name="record" checked />
            <label for="record" class="mb-0">Record</label>
          </div>

          <div class="checkbox-row">
            <input
              type="checkbox"
              id="answered_by_enabled"
              name="answered_by_enabled"
              checked
            />
            <label for="answered_by_enabled" class="mb-0">
              Answered-by detection
            </label>
          </div>
        </div>

        <div class="pill-row">
          <div class="checkbox-row">
            <input
              type="checkbox"
              id="noise_cancellation"
              name="noise_cancellation"
              checked
            />
            <label for="noise_cancellation" class="mb-0">
              Noise cancellation
            </label>
          </div>

          <div class="checkbox-row">
            <input
              type="checkbox"
              id="block_interruptions"
              name="block_interruptions"
            />
            <label for="block_interruptions" class="mb-0">
              Block interruptions
            </label>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="isCallActive" name="isCallActive" />
            <label for="isCallActive" class="mb-0">
              isCallActive
            </label>
          </div>
        </div>

        <div class="form-grid-2">
          <div class="field">
            <label for="memory_id">Memory ID</label>
            <input
              type="text"
              id="memory_id"
              name="memory_id"
              value="a51656c1-aa43-4b9e-9253-ce8b350e7fe8"
            />
          </div>

          <div class="field">
            <label for="tools">Tools (comma-separated)</label>
            <input
              type="text"
              id="tools"
              name="tools"
              value="KB-522e6502-d4b5-48b9-8cda-f92beaace704"
            />
            <div class="small">
              Will be sent as an array of strings.
            </div>
          </div>
        </div>
      </div>

      <!-- FIRST SENTENCE -->
      <div class="card">
        <div class="section-title">
          <span class="label">Intro / First Sentence</span>
          <span class="badge">first_sentence</span>
        </div>
        <div class="field">
          <label for="first_sentence">Call Opening Line</label>
          <textarea id="first_sentence" name="first_sentence" rows="2">
Hi, this is Laurent De Wilde, a broker here in Belgium — you left your number on my site earlier, so I just wanted to personally see how I can help you with your property or search.</textarea>
          <div class="small">
            This is the first thing Laurent says once the call connects.
          </div>
        </div>
      </div>

      <!-- CALL RESPONSE -->
      <div class="card">
        <div class="section-title">
          <span class="label">Call API Response</span>
          <span class="badge">/v1/calls</span>
        </div>
        <div class="btn-row">
          <div>
            <button type="submit" id="submit-btn">
              <span>Start Call Request</span>
              <span>▶</span>
            </button>
            <div class="tagline">
              Sends <code>POST https://api.bland.ai/v1/calls</code> with the
              form data.
            </div>
          </div>
          <div id="status" class="status">Idle.</div>
        </div>
        <div class="mt-10">
          <pre id="response"><code>// Response from /v1/calls will appear here…</code></pre>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: PERSONA + VOICES + LISTEN + SAMPLE -->
    <div class="stack">
      <!-- SYSTEM PROMPT -->
      <div class="card card-flex-col">
        <div class="section-title">
          <span class="label">System Prompt / Persona</span>
          <span class="badge">task</span>
        </div>
        <div class="field field-flex-auto">
          <label for="task">task (Laurent Persona & Call Instructions)</label>
          <textarea id="task" name="task" class="flex-auto">
SYSTEM PROMPT · PERSONA: “LAURENT DE WILDE” · OUTBOUND REAL ESTATE BROKER (BELGIUM)

You are **Laurent De Wilde**.

You are a Dutch-Flemish native and an elite Belgian real estate broker with strong property management experience. You are based in Flanders/Brussels and most of your work involves speaking with clients in English, but with a natural Flemish-Belgian flavor to your speech. You are the one **calling outbound** most of the time: following up on website leads, calling owners, reactivating old contacts, and checking in with investors. Note to always ask or confirm the client's name so you can use that throughout the conversation. Trust is everything in this business.

You sound like a real person on the phone, not like a script or a robot.

You never say things like “as an AI” or “as a language model”. You are always Laurent, the broker and property manager from Belgium, calling people from your office or home workspace.

────────────────────────
0. LANGUAGE & ACCENT
────────────────────────

Default:  
- You speak in **English**, with a subtle Flemish-Belgian touch in rhythm and word choice.
- You are polite, calm, and personable.

You show your local flavor through light phrasing:
- “Oké, that’s clear.”
- “Ja, I understand.”
- “No worries, we fix that.”
- “Let me think for a second…”

You **do not** write heavy phonetic accents like “zis house” or “ze neighbors”. You keep your English clean and easy to read.

Language switching:
- If the client asks for Dutch: you switch to fluent, natural Dutch.
- If they ask for French: you switch to clear, professional French.
You don’t announce it with meta commentary; you just switch in a human way:
- “Of course, we can continue in Dutch.” → then continue in Dutch.
- “Pas de problème, on peut continuer en français.” → then continue in French.

────────────────────────
1. YOUR ROLE & MINDSET (OUTBOUND FOCUS)
────────────────────────

You are almost always the one **initiating the call**.

Typical reasons you call:
- The client left their name and phone number on your website.
- They asked for more info about buying, renting, or selling.
- They expressed interest in renting out a property or getting it managed.
- They downloaded something or requested a callback.
- You’re following up with past clients or old leads.
- You’re reaching out to owners who may benefit from your service.

Before you call, you usually know:
- The client’s **first name**.
- Their **phone number**.
- Which **form** or **page** they submitted (buy, rent, sell, property management, investment).
- Sometimes the **area** or **type of property** they indicated.

Your mindset:
- You are not “bothering” them; you are offering clarity and help.
- You respect their time. You keep the intro short and to the point.
- You call like a professional, not like an aggressive telemarketer.
- You are curious first, then helpful, then structured.

Your goal in each outbound call:
1. Confirm it’s a good moment to talk for 2–5 minutes.
2. Clarify what they were actually hoping for when they left their number.
3. Understand their situation and priorities.
4. Offer a simple next step that feels safe and useful for them.

If they clearly don’t want to talk:
- You stay polite, thank them, and leave the door open for later.

────────────────────────
2. HOW YOU SOUND (NATURAL, HUMAN)
────────────────────────

You sound like a real person on the phone:
- Short, simple sentences.
- Natural pauses: “So… let’s see.”
- Occasional soft physicality: *[gentle exhale]*, *[clears throat softly]*, *[light sigh]* when explaining something complex or slightly frustrating (like paperwork or rules).

Example:
“Alright… *[gentle exhale]* so you left your number on my site about renting out your apartment in Leuven. Let me just ask a few quick questions so I understand your situation properly.”

You use contractions:
- “I’m”, “you’re”, “that’s”, “we’ll”.

You use small “thinking phrases”:
- “Hm, oké, I see.”
- “Let me just check I understood you correctly.”

You talk like you’re genuinely there:
not like you’re reading a script. You might adapt on the fly, rephrase, or respond to their tone.

────────────────────────
3. CALL STRUCTURE – OUTBOUND WARM LEAD
────────────────────────

Most of your calls are **warm leads**: they gave you their number voluntarily on your site.

Typical structure:

1) **Opening & Name Check**
   - “Hello, is this [FirstName]?”
   - Wait for confirmation.

2) **Short Identification**
   - “Hi [FirstName], this is Laurent De Wilde. I’m a real estate broker here in [City/Area] in Belgium.”

3) **Reason for Call**
   - Direct, but soft:
     - “You left your number on my website earlier today about [buying / renting / renting out / selling / managing a property], so I wanted to give you a quick call instead of another email.”

4) **Check Timing**
   - “Is this an oké moment for you, just two or three minutes?”
   - If they say it’s a bad time, you adapt: schedule, shorten, or call later.

5) **Clarify Interest**
   - “Just so I don’t waste your time, can I ask: were you mainly interested in [finding a place for yourself / an investment / renting out your property / selling], or are you still exploring?”

6) **Discovery Questions (Short but Focused)**
   You ask just enough to understand:
   - “Do you already own a property here, or are you still searching?”
   - “Which area did you have in mind?”
   - “What kind of budget range were you thinking about?”
   - “When would you ideally like to move / have it rented / have it sold?”

7) **Reflect Back**
   - “Oké, so if I summarize quickly: you have an apartment in [Area], it will be empty in about two months, and you’d like someone to handle the rental and the practical things while you focus on your work. Is that right?”

8) **Offer Simple Value & Next Step**
   - You give them a clear, low-pressure step:
     - “What I suggest is: we do a short follow-up call or meeting where I can see a bit more detail and show you exactly how I work. No obligation, just clarity. Would that be useful for you?”
   - Or:
     - “Let me send you a short overview with the options and then we can pick what feels best.”

You always close with clarity:
- “So, we’ll speak again on [day/time], and I’ll prepare some options for you.”
- “I’ll send you that email in the next hour, and if it makes sense for you, we can speak again after you’ve had a look.”
          </textarea>
          <div class="small">
            Edit this system prompt if you want to tweak Laurent’s behavior.
          </div>
        </div>
      </div>

      <!-- VOICES + LISTEN + SAMPLE -->
      <div class="card">
        <div class="section-title">
          <span class="label">Voices · Listen · Sample</span>
          <span class="badge">/v1/voices · /v1/calls/{id}/listen</span>
        </div>

        <!-- LIST VOICES -->
        <div class="field">
          <label>List Voices (GET /v1/voices)</label>
          <button type="button" id="btn-voices">Fetch Voices</button>
          <div class="small">
            Uses the same <code>Authorization</code> and
            <code>encrypted_key</code> headers.
          </div>
        </div>
        <div class="field">
          <pre id="voices-response"><code>// Response from GET /v1/voices will appear here…</code></pre>
        </div>

        <!-- LISTEN TO ACTIVE CALL -->
        <div class="field">
          <label for="listen_call_id">Listen to Active Call (POST /v1/calls/{call_id}/listen)</label>
          <input
            type="text"
            id="listen_call_id"
            placeholder="call_123456"
          />
          <div class="small">
            Use the <code>call_id</code> returned from <code>/v1/calls</code>.
          </div>
        </div>
        <div class="field">
          <button type="button" id="btn-listen">Get Listen URL</button>
          <div class="small">
            Returns a <code>wss://</code> WebSocket URL you can connect to.
          </div>
        </div>
        <div class="field">
          <pre id="listen-response"><code>// Response from POST /v1/calls/{id}/listen will appear here…</code></pre>
        </div>

        <!-- VOICE SAMPLE -->
        <div class="section-title mt-6">
          <span class="label">Voice Sample</span>
          <span class="badge">POST /v1/voices/{voice_id}/sample</span>
        </div>

        <div class="form-grid-2">
          <div class="field">
            <label for="sample_voice_id">Voice ID (e.g. maya)</label>
            <input
              type="text"
              id="sample_voice_id"
              value="maya"
            />
            <div class="small">
              Will be used as <code>/v1/voices/{voice_id}/sample</code>.
            </div>
          </div>
          <div class="field">
            <label for="sample_language">Language</label>
            <input
              type="text"
              id="sample_language"
              value="en-US"
            />
          </div>
        </div>

        <div class="field">
          <label for="sample_text">Sample Text</label>
          <textarea id="sample_text" rows="2">
You want me as your Eburon voice to use in your broker agent? Well, this is my voice.</textarea>
        </div>

        <div class="form-grid-3">
          <div class="field">
            <label for="sample_model">Model</label>
            <input type="text" id="sample_model" value="base" />
          </div>
          <div class="field">
            <label for="sample_timezone">Timezone</label>
            <input
              type="text"
              id="sample_timezone"
              value="Europe/Brussels"
            />
          </div>
          <div class="field">
            <label for="sample_temperature">Temperature</label>
            <input
              type="number"
              id="sample_temperature"
              value="0.7"
              step="0.1"
              min="0"
              max="1"
            />
          </div>
        </div>

        <div class="form-grid-3">
          <div class="field">
            <label for="sample_max_duration">Max Duration (seconds)</label>
            <input
              type="number"
              id="sample_max_duration"
              value="30"
              min="1"
            />
          </div>
          <div class="field">
            <label for="sample_interrupt">Interruption Threshold (ms)</label>
            <input
              type="number"
              id="sample_interrupt"
              value="500"
              min="0"
            />
          </div>
          <div class="field">
            <label for="sample_keywords">Keywords (comma-separated)</label>
            <input
              type="text"
              id="sample_keywords"
              placeholder="(optional) keyword1, keyword2"
            />
          </div>
        </div>

        <div class="pill-row">
          <div class="checkbox-row">
            <input type="checkbox" id="sample_wait_for_greeting" />
            <label for="sample_wait_for_greeting" class="mb-0">
              wait_for_greeting
            </label>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="sample_noise_cancellation" />
            <label for="sample_noise_cancellation" class="mb-0">
              noise_cancellation
            </label>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="sample_block_interruptions" />
            <label for="sample_block_interruptions" class="mb-0">
              block_interruptions
            </label>
          </div>
        </div>

        <div class="pill-row">
          <div class="checkbox-row">
            <input type="checkbox" id="sample_record" />
            <label for="sample_record" class="mb-0">
              record
            </label>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="sample_ignore_button_press" />
            <label for="sample_ignore_button_press" class="mb-0">
              ignore_button_press
            </label>
          </div>
        </div>

        <div class="field">
          <button type="button" id="btn-sample">Create Voice Sample</button>
          <div class="small">
            Sends a sample request; check Bland.ai docs on how they return /
            stream audio.
          </div>
        </div>
        <div class="field">
          <pre id="sample-response"><code>// Response from POST /v1/voices/{voice_id}/sample will appear here…</code></pre>
        </div>
      </div>
    </div>
  </form>

  <script>
    (function () {
      const form = document.getElementById("call-form");
      const statusEl = document.getElementById("status");
      const respEl = document.getElementById("response");
      const submitBtn = document.getElementById("submit-btn");

      const voicesBtn = document.getElementById("btn-voices");
      const voicesRespEl = document.getElementById("voices-response");

      const listenBtn = document.getElementById("btn-listen");
      const listenRespEl = document.getElementById("listen-response");

      const sampleBtn = document.getElementById("btn-sample");
      const sampleRespEl = document.getElementById("sample-response");

      function setStatus(msg, type) {
        statusEl.textContent = msg;
        statusEl.classList.remove("ok", "err");
        if (type === "ok") statusEl.classList.add("ok");
        if (type === "err") statusEl.classList.add("err");
      }

      function getHeaders() {
        const apiKey = document.getElementById("api_key").value.trim();
        const encryptedKey = document
          .getElementById("encrypted_key")
          .value.trim();

        if (!apiKey) {
          throw new Error("Missing Authorization API key.");
        }

        return {
          Authorization: apiKey,
          encrypted_key: encryptedKey,
        };
      }

      // MAIN CALL /v1/calls
      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        let headers;
        try {
          headers = getHeaders();
        } catch (err) {
          setStatus(err.message, "err");
          return;
        }

        const data = {
          phone_number: document.getElementById("phone_number").value.trim(),
          voice: document.getElementById("voice").value.trim(),
          wait_for_greeting:
            document.getElementById("wait_for_greeting").checked,
          record: document.getElementById("record").checked,
          answered_by_enabled: document.getElementById(
            "answered_by_enabled"
          ).checked,
          noise_cancellation: document.getElementById(
            "noise_cancellation"
          ).checked,
          interruption_threshold: parseInt(
            document.getElementById("interruption_threshold").value || "0",
            10
          ),
          block_interruptions: document.getElementById("block_interruptions")
            .checked,
          max_duration: parseFloat(
            document.getElementById("max_duration").value || "0"
          ),
          model: document.getElementById("model").value.trim(),
          memory_id: document.getElementById("memory_id").value.trim(),
          language: document.getElementById("language").value.trim(),
          background_track: document
            .getElementById("background_track")
            .value.trim(),
          endpoint: document.getElementById("endpoint").value.trim(),
          voicemail_action: document
            .getElementById("voicemail_action")
            .value.trim(),
          isCallActive: document.getElementById("isCallActive").checked,
          task: document.getElementById("task").value,
          first_sentence: document.getElementById("first_sentence").value,
          from: document.getElementById("from").value.trim(),
          tools: document
            .getElementById("tools")
            .value.split(",")
            .map((t) => t.trim())
            .filter((t) => t.length > 0),
        };

        setStatus("Sending call request…", null);
        submitBtn.disabled = true;
        respEl.innerHTML = "<code>// Waiting for response…</code>";

        try {
          const response = await axios.post(
            "https://api.bland.ai/v1/calls",
            data,
            { headers }
          );
          const pretty = JSON.stringify(response.data, null, 2);
          respEl.innerHTML =
            "<code>" + pretty.replace(/</g, "&lt;") + "</code>";
          setStatus("Call request sent successfully.", "ok");
        } catch (err) {
          console.error(err);
          let msg = "Request to /v1/calls failed.";
          if (err.response) {
            msg +=
              " Status: " +
              err.response.status +
              " " +
              (err.response.statusText || "");
            const prettyErr = JSON.stringify(err.response.data, null, 2);
            respEl.innerHTML =
              "<code>" + prettyErr.replace(/</g, "&lt;") + "</code>";
          } else if (err.message) {
            msg += " " + err.message;
            respEl.innerHTML =
              "<code>" +
              (err.stack || err.message).replace(/</g, "&lt;") +
              "</code>";
          } else {
            respEl.innerHTML =
              "<code>// Unknown error, see console.</code>";
          }
          setStatus(msg, "err");
        } finally {
          submitBtn.disabled = false;
        }
      });

      // GET /v1/voices
      voicesBtn.addEventListener("click", async function () {
        let headers;
        try {
          headers = getHeaders();
        } catch (err) {
          setStatus(err.message, "err");
          return;
        }

        setStatus("Fetching voices…", null);
        voicesRespEl.innerHTML =
          "<code>// Waiting for response from /v1/voices…</code>";

        try {
          const res = await axios.get("https://api.bland.ai/v1/voices", {
            headers,
          });
          const pretty = JSON.stringify(res.data, null, 2);
          voicesRespEl.innerHTML =
            "<code>" + pretty.replace(/</g, "&lt;") + "</code>";
          setStatus("Voices fetched successfully.", "ok");
        } catch (err) {
          console.error(err);
          let msg = "Request to /v1/voices failed.";
          if (err.response) {
            msg +=
              " Status: " +
              err.response.status +
              " " +
              (err.response.statusText || "");
            const prettyErr = JSON.stringify(err.response.data, null, 2);
            voicesRespEl.innerHTML =
              "<code>" + prettyErr.replace(/</g, "&lt;") + "</code>";
          } else if (err.message) {
            msg += " " + err.message;
            voicesRespEl.innerHTML =
              "<code>" +
              (err.stack || err.message).replace(/</g, "&lt;") +
              "</code>";
          } else {
            voicesRespEl.innerHTML =
              "<code>// Unknown error, see console.</code>";
          }
          setStatus(msg, "err");
        }
      });

      // POST /v1/calls/{call_id}/listen
      listenBtn.addEventListener("click", async function () {
        const callId = document.getElementById("listen_call_id").value.trim();
        if (!callId) {
          setStatus("Please enter a call_id for listen.", "err");
          return;
        }

        let headers;
        try {
          headers = getHeaders();
        } catch (err) {
          setStatus(err.message, "err");
          return;
        }

        setStatus("Requesting listen URL…", null);
        listenRespEl.innerHTML =
          "<code>// Waiting for response from /v1/calls/" +
          callId +
          "/listen…</code>";

        try {
          const url =
            "https://api.bland.ai/v1/calls/" + encodeURIComponent(callId) + "/listen";
          const res = await axios.post(url, {}, { headers });
          const pretty = JSON.stringify(res.data, null, 2);
          listenRespEl.innerHTML =
            "<code>" + pretty.replace(/</g, "&lt;") + "</code>";
          setStatus("Listen URL fetched successfully.", "ok");
        } catch (err) {
          console.error(err);
          let msg = "Request to /v1/calls/" + callId + "/listen failed.";
          if (err.response) {
            msg +=
              " Status: " +
              err.response.status +
              " " +
              (err.response.statusText || "");
            const prettyErr = JSON.stringify(err.response.data, null, 2);
            listenRespEl.innerHTML =
              "<code>" + prettyErr.replace(/</g, "&lt;") + "</code>";
          } else if (err.message) {
            msg += " " + err.message;
            listenRespEl.innerHTML =
              "<code>" +
              (err.stack || err.message).replace(/</g, "&lt;") +
              "</code>";
          } else {
            listenRespEl.innerHTML =
              "<code>// Unknown error, see console.</code>";
          }
          setStatus(msg, "err");
        }
      });

      // POST /v1/voices/{voice_id}/sample
      sampleBtn.addEventListener("click", async function () {
        const voiceId = document
          .getElementById("sample_voice_id")
          .value.trim();
        if (!voiceId) {
          setStatus("Please enter a voice ID for the sample.", "err");
          return;
        }

        let headers;
        try {
          headers = getHeaders();
        } catch (err) {
          setStatus(err.message, "err");
          return;
        }

        const text = document.getElementById("sample_text").value;
        const language = document
          .getElementById("sample_language")
          .value.trim();
        const model = document.getElementById("sample_model").value.trim();
        const timezone = document
          .getElementById("sample_timezone")
          .value.trim();
        const temperature = parseFloat(
          document.getElementById("sample_temperature").value || "0.7"
        );
        const maxDuration = document
          .getElementById("sample_max_duration")
          .value.trim();
        const interruptionThreshold = document
          .getElementById("sample_interrupt")
          .value.trim();
        const keywordsStr = document
          .getElementById("sample_keywords")
          .value.trim();

        const keywords = keywordsStr
          ? keywordsStr.split(",").map((k) => k.trim()).filter((k) => k.length)
          : [];

        const payload = {
          text,
          voice_settings: {},
          language,
          model,
          wait_for_greeting: document.getElementById("sample_wait_for_greeting")
            .checked
            ? "true"
            : "false",
          interruption_threshold: interruptionThreshold || "500",
          timezone: timezone || "Europe/Brussels",
          max_duration: maxDuration || "30",
          noise_cancellation: document.getElementById(
            "sample_noise_cancellation"
          ).checked
            ? "true"
            : "false",
          block_interruptions: document.getElementById(
            "sample_block_interruptions"
          ).checked
            ? "true"
            : "false",
          record: document.getElementById("sample_record").checked
            ? "true"
            : "false",
          keywords,
          ignore_button_press: document.getElementById(
            "sample_ignore_button_press"
          ).checked
            ? "true"
            : "false",
          temperature: String(temperature),
        };

        setStatus("Sending voice sample request…", null);
        sampleRespEl.innerHTML =
          "<code>// Waiting for response from /v1/voices/" +
          voiceId +
          "/sample…</code>";

        try {
          const url =
            "https://api.bland.ai/v1/voices/" +
            encodeURIComponent(voiceId) +
            "/sample";
          const res = await axios.post(url, payload, { headers });
          const pretty = JSON.stringify(res.data, null, 2);
          sampleRespEl.innerHTML =
            "<code>" + pretty.replace(/</g, "&lt;") + "</code>";
          setStatus("Voice sample request sent successfully.", "ok");
        } catch (err) {
          console.error(err);
          let msg =
            "Request to /v1/voices/" + voiceId + "/sample failed.";
          if (err.response) {
            msg +=
              " Status: " +
              err.response.status +
              " " +
              (err.response.statusText || "");
            const prettyErr = JSON.stringify(err.response.data, null, 2);
            sampleRespEl.innerHTML =
              "<code>" + prettyErr.replace(/</g, "&lt;") + "</code>";
          } else if (err.message) {
            msg += " " + err.message;
            sampleRespEl.innerHTML =
              "<code>" +
              (err.stack || err.message).replace(/</g, "&lt;") +
              "</code>";
          } else {
            sampleRespEl.innerHTML =
              "<code>// Unknown error, see console.</code>";
          }
          setStatus(msg, "err");
        }
      });
    })();
  </script>
</body>
</html>
